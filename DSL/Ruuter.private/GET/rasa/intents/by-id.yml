declaration:
  call: declare
  version: 0.1
  description: "Get intent with details by ID"
  method: get
  accepts: json
  returns: json
  namespace: training
  allowlist:
    # headers:
    #   - field: cookie
    #     type: string
    #     description: "Cookie field"
    params:
      - field: intent
        type: string
        description: "Intent ID"

assignValues:
  assign:
    intent: ${incoming.params.intent}

getIntents:
  call: http.post
  args:
    url: "[#TRAINING_OPENSEARCH]/intents/_search/template"
    body:
      id: "intent-with-name"
      params:
        intent: ${intent}
  result: getIntentsResult
  next: getIntentData

getIntentData:
  call: http.post
  args:
    url: "[#TRAINING_DMAPPER]/hbs/training/get_intents_with_examples"
    headers:
      type: "json"
    body:
      hits: ${getIntentsResult.response.body.hits.hits}
  result: getIntentDataResult
  next: returnSuccess

returnSuccess:
  return: ${getIntentDataResult.response.body}
  next: end

returnNoIntentsFound:
  return: "Error: no intents found"
  wrapper: false
  status: 409
  next: end
